# SDK Data Access Debugging Plan

**작성일시:** 2026-02-20 12:00
**작성자:** Antigravity (Senior Firmware Architect)

## 1. 문제 상황 (Issue)
-   **증상:** `webPageByEmail` 페이지 진입 시 로그에 `[Time] Realtime Update: 0 posts loaded`가 표시되며, 저장된 게시물이 보이지 않음.
-   **분석:** `onSnapshot` 리스너가 성공적으로 연결되었고 에러 없이 콜백이 실행되었으나, 문서 수(`size`)가 0임.

## 2. 가설 (Hypotheses)

| 가설 | 설명 | 가능성 |
| :--- | :--- | :--- |
| **H1. Index 누락** | `orderBy('createdAt', 'desc')` 쿼리 실행 시 단일 필드 인덱스 문제 또는 복합 인덱스 필요성. (보통 에러가 발생하지만, SDK 버전에 따라 조용히 실패할 수도 있음) | **높음** |
| **H2. Path 불일치** | REST API가 저장하던 경로와 SDK가 읽는 경로(`users/{uid}/web_clipper`)가 미세하게 다름 (예: 공백 포함, 컬렉션명 오타 등). | 중간 |
| **H3. Data Type** | REST API로 저장된 `createdAt` 필드 타입과 SDK가 기대하는 타입이 달라 정렬 시 제외됨. | 낮음 |
| **H4. Config 오류** | `api-config.js`의 `projectId`가 실제 데이터가 있는 프로젝트와 다름. | 낮음 |

## 3. 디버깅 계획 (Action Plan)

안전한 디버깅을 위해 `webPageByEmail/script.js`를 단계적으로 수정하여 원인을 파악합니다.

### Step 1: 쿼리 단순화 (Simplify Query)
-   **내용:** `.orderBy('createdAt', 'desc')` 및 `.limit(50)`을 제거하고 단순 컬렉션 조회(`db.collection(...).get()`)를 시도.
-   **목적:** 데이터 존재 여부 확인 (H1 검증). 만약 데이터가 보이면 인덱스/정렬 문제임.

### Step 2: 경로 및 상세 로그 추가 (Verbose Logging)
-   **내용:**
    -   현재 접근 중인 `user.uid` 출력.
    -   `snapshot.empty` 여부 및 `snapshot.metadata` 출력.
    -   데이터 저장 테스트: SDK로 **새로운 데이터**를 저장해보고, 그 데이터는 보이는지 확인.
-   **목적:** H2, H3 검증. 만약 새 데이터는 보이는데 옛날 데이터가 안 보이면 데이터 호환성 문제.

## 4. 수행 코드 (Code Modification)
`script.js`의 `initBoardListener` 함수를 임시로 수정합니다.

```javascript
/* Modified initBoardListener for Debugging */
function initBoardListener(user) {
    if (unsubscribe) unsubscribe();

    log(`[DEBUG] Target Path: users/${user.uid}/web_clipper`, 'info');

    // 1. Try Simple Get (No OrderBy)
    window.db.collection('users').doc(user.uid).collection('web_clipper')
        .get()
        .then(snap => {
            log(`[DEBUG] Simple Query Found: ${snap.size} docs`, snap.empty ? 'warn' : 'success');
            if (!snap.empty) {
                snap.forEach(d => console.log(d.id, d.data()));
            }
        })
        .catch(e => log(`[DEBUG] Simple Query Error: ${e.message}`, 'error'));

    // 2. Original Listener (Keep it to see if it works alongside)
    // ...
}
```

## 5. 승인 요청
위 디버깅 코드를 적용하여 로그를 분석해도 될까요?
