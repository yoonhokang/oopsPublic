# 이메일 본문에 HTML 콘텐츠 자동 삽입 — 방법 검토 보고서

> **작성일**: 2026-02-21  
> **주제**: 보안 수준을 유지하면서 이메일 본문에 웹 페이지 콘텐츠를 사전 삽입하는 방법

---

## 1. 현재 방식

```
[1] cleanHtml() → HTML 정제
[2] navigator.clipboard.write() → 클립보드에 HTML 복사
[3] mailto: → 이메일 클라이언트 열기
[4] 사용자가 Ctrl+V → 메일 본문에 붙여넣기 (수동)
```

**문제**: [4]번 단계가 수동이므로 UX가 불완전함

---

## 2. 기술적 제약: `mailto:`는 HTML을 지원하지 않음

`mailto:` 프로토콜의 `body` 파라미터는 **플레인 텍스트만** 지원합니다:

```
mailto:?subject=Title&body=Hello → 텍스트만 가능
                                  HTML 태그 불가, 이미지 불가
```

또한 URL 길이 제한(약 2,000자)이 있어 웹 페이지 콘텐츠를 body에 넣는 것 자체가 불가능합니다.

---

## 3. 대안 방법 비교

### 방안 A: Gmail API — Draft(임시저장) 생성 ⭐ 권장

```
[1] 사용자가 Gmail OAuth2 권한 허용 (최초 1회)
[2] cleanHtml() → HTML 정제
[3] Gmail API: drafts.create → HTML 본문이 포함된 임시 메일 생성
[4] Gmail 임시보관함으로 이동 → 사용자가 확인 후 전송
```

| 항목 | 평가 |
|---|---|
| **보안** | ✅ OAuth2 표준 인증, 사용자가 직접 권한 부여 |
| **UX** | ✅ 붙여넣기 불필요, 임시보관함에서 바로 전송 |
| **HTML 지원** | ✅ MIME 형식으로 HTML + 이미지 포함 가능 |
| **복잡도** | ⚠️ 중간 — Google Cloud 프로젝트 설정 + OAuth scope 추가 필요 |
| **비용** | ✅ 무료 (Gmail API 일일 할당량 내) |

**필요한 작업:**
1. Google Cloud Console에서 Gmail API 활성화
2. OAuth consent screen에 `gmail.compose` scope 추가
3. `gapi.client` 라이브러리 로드 + 인증 흐름 구현
4. RFC 2822 MIME 메시지 생성 후 `drafts.create` 호출

**보안 고려사항:**
- `gmail.compose` scope는 이메일 **읽기 권한 없음** — 작성/전송만 가능
- 사용자가 OAuth 동의 화면에서 명시적으로 승인해야 함
- Firebase Auth와 별개의 OAuth 흐름이 필요 (추가 로그인 팝업 1회 발생)

---

### 방안 B: 서버사이드 이메일 전송 (Cloud Functions + SMTP)

```
[1] 사용자가 "Send Email" 클릭
[2] Firebase Cloud Function 호출
[3] 서버에서 SMTP로 HTML 이메일 직접 전송
[4] 사용자에게 "전송 완료" 알림
```

| 항목 | 평가 |
|---|---|
| **보안** | ✅ SMTP 인증 정보는 서버에만 존재 |
| **UX** | ⚠️ 사용자가 전송 전 내용을 확인할 수 없음 |
| **HTML 지원** | ✅ 완전 지원 |
| **복잡도** | ❌ 높음 — Cloud Functions 배포, SMTP 설정, 수신자 입력 UI 필요 |
| **비용** | ⚠️ Cloud Functions 사용량에 따라 과금 가능 |

**단점**: 사용자가 메일을 **검토 없이 바로 전송**하게 되므로, 오전송 위험 있음

---

### 방안 C: 제3자 이메일 API (EmailJS, SendGrid 등)

```
[1] 프론트엔드에서 EmailJS SDK 호출
[2] EmailJS가 SMTP 중계하여 HTML 이메일 전송
```

| 항목 | 평가 |
|---|---|
| **보안** | ⚠️ API 키가 프론트엔드에 노출됨 (Public Key 방식이지만 남용 가능) |
| **UX** | ⚠️ 방안 B와 동일 — 검토 없이 전송 |
| **HTML 지원** | ✅ 완전 지원 |
| **복잡도** | ✅ 낮음 — SDK 로드 + API 호출만 |
| **비용** | ⚠️ 무료 플랜 한도 있음 (EmailJS: 200건/월) |

**단점**: API 키 노출 + 전송 전 검토 불가 + 월 전송 한도

---

### 방안 D: 현재 방식 개선 (클립보드 + 안내 UX 강화)

```
[1] 클립보드에 복사 (기존과 동일)
[2] 토스트 메시지: "✅ 복사 완료! 이메일 본문에 Ctrl+V를 눌러주세요"
[3] mailto: 열기 (기존과 동일)
```

| 항목 | 평가 |
|---|---|
| **보안** | ✅ 현재와 동일 |
| **UX** | △ 수동 붙여넣기는 여전히 필요하지만, 안내가 더 명확해짐 |
| **복잡도** | ✅ 최소 — 현재 코드에서 안내 메시지만 수정 |
| **비용** | ✅ 무료 |

---

## 4. 종합 비교

| 방안 | 보안 | UX | 복잡도 | 사전 검토 | HTML |
|---|---|---|---|---|---|
| **A: Gmail API** | ✅ | ✅ | 중간 | ✅ 임시보관함 | ✅ |
| **B: Cloud Functions** | ✅ | ⚠️ | 높음 | ❌ | ✅ |
| **C: EmailJS 등** | ⚠️ | ⚠️ | 낮음 | ❌ | ✅ |
| **D: UX 개선만** | ✅ | △ | 최소 | ✅ (수동) | ✅ |

---

## 5. 결론

> **"보안 수준을 낮추지 않으면서 메일 본문에 HTML이 들어가게"** 하려면, **방안 A (Gmail API Draft)가 유일하게 실현 가능**합니다.

다만 구현 복잡도가 있으므로, 단계적 접근을 권장합니다:

1. **1단계 (즉시)**: 방안 D — 현재 UX를 안내 메시지로 개선
2. **2단계 (향후)**: 방안 A — Gmail API 연동으로 자동 Draft 생성

방안 B, C는 "전송 전 검토 불가"라는 보안/UX 문제가 있어 권장하지 않습니다.

---

*문서 끝*
