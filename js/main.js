/**
 * ============================================================
 * ë©”ì¸ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ (main.js)
 * ============================================================
 *
 * ã€ì´ íŒŒì¼ì˜ ì—­í• ã€‘
 * ë©”ì¸ í˜ì´ì§€(index.html)ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ë¡œì§ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
 * ì›ë˜ index.html ì•ˆì— <script> íƒœê·¸ë¡œ ì§ì ‘ ì‘ì„±ë˜ì–´ ìˆë˜ ì½”ë“œë¥¼
 * CSP(Content Security Policy) ë³´ì•ˆ ì •ì±… ê°œì„ ì„ ìœ„í•´ ì™¸ë¶€ íŒŒì¼ë¡œ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.
 *
 * ã€ì£¼ìš” ê¸°ëŠ¥ã€‘
 * 1. ì¸ì¦ ê°€ë“œ: ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ë„êµ¬ í˜ì´ì§€ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì°¨ë‹¨
 * 2. í† ìŠ¤íŠ¸ ë©”ì‹œì§€: ë¸Œë¼ìš°ì € ê¸°ë³¸ alert() ëŒ€ì‹  ì„¸ë ¨ëœ ì•Œë¦¼ í‘œì‹œ
 *
 * ã€ì˜ì¡´ì„±ã€‘
 * - firebase-app.js, firebase-auth.js (ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸)
 * - api-config.js (Firebase ì„¤ì •)
 * - auth.js (registerAuthListener í•¨ìˆ˜ ì œê³µ)
 */

(function () {
    "use strict";

    // â”€â”€â”€ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í•¨ìˆ˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /**
     * í™”ë©´ ìƒë‹¨ ì¤‘ì•™ì— í† ìŠ¤íŠ¸(Toast) ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.
     *
     * ã€í† ìŠ¤íŠ¸ë€?ã€‘
     * ì¼ì • ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ” ì‘ì€ ì•Œë¦¼ ë©”ì‹œì§€ì…ë‹ˆë‹¤.
     * ë¸Œë¼ìš°ì €ì˜ alert()ê³¼ ë‹¬ë¦¬ ì‚¬ìš©ìì˜ ì‘ì—…ì„ ë°©í•´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
     *
     * ã€ë™ì‘ ì›ë¦¬ã€‘
     * 1. div ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  bodyì— ì¶”ê°€
     * 2. CSS í´ë˜ìŠ¤(.show)ë¥¼ ì¶”ê°€í•˜ì—¬ í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
     * 3. ì§€ì •ëœ ì‹œê°„ í›„ .show í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ì—¬ í˜ì´ë“œì•„ì›ƒ
     * 4. ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ DOMì—ì„œ ìš”ì†Œ ì œê±°
     *
     * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
     * @param {number} duration - í‘œì‹œ ì‹œê°„(ë°€ë¦¬ì´ˆ), ê¸°ë³¸ 3000ms(3ì´ˆ)
     */
    function showToast(message, duration = 3000) {
        // ì´ë¯¸ í‘œì‹œ ì¤‘ì¸ í† ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        const existing = document.getElementById('globalToast');
        if (existing) existing.remove();

        // í† ìŠ¤íŠ¸ ìš”ì†Œ ìƒì„±
        const toast = document.createElement('div');
        toast.id = 'globalToast';
        toast.className = 'toast-notification'; // css/style.cssì— ìŠ¤íƒ€ì¼ ì •ì˜ë¨
        toast.textContent = message;
        document.body.appendChild(toast);

        // requestAnimationFrame: ë‹¤ìŒ í™”ë©´ ê°±ì‹  ì‹œì ì— ì‹¤í–‰
        // â†’ appendChild ì§í›„ ë°”ë¡œ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ë©´ ë¸Œë¼ìš°ì €ê°€ íŠ¸ëœì§€ì…˜ì„ ê°ì§€í•˜ì§€ ëª»í•  ìˆ˜ ìˆìŒ
        requestAnimationFrame(() => {
            toast.classList.add('show'); // í˜ì´ë“œì¸ íŠ¸ë¦¬ê±°
        });

        // ì¼ì • ì‹œê°„ í›„ ìë™ ìˆ¨ê¹€
        setTimeout(() => {
            toast.classList.remove('show'); // í˜ì´ë“œì•„ì›ƒ íŠ¸ë¦¬ê±°
            setTimeout(() => toast.remove(), 300); // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ DOMì—ì„œ ì œê±°
        }, duration);
    }

    // â”€â”€â”€ DOMContentLoaded ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // HTML ë¬¸ì„œê°€ ì™„ì „íˆ íŒŒì‹±ë˜ë©´ ì‹¤í–‰ë©ë‹ˆë‹¤.
    // â€» ì´ë¯¸ì§€ë‚˜ CSS ë¡œë”© ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šìœ¼ë¯€ë¡œ ë¹ ë¥´ê²Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', () => {

        // â”€â”€ ì¸ì¦ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ â”€â”€
        // auth.jsì—ì„œ ì •ì˜í•œ registerAuthListener() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒí•  ë•Œë§ˆë‹¤ ì½œë°±ì´ í˜¸ì¶œë©ë‹ˆë‹¤.
        if (window.registerAuthListener) {
            window.registerAuthListener((user) => {
                console.log("[ë©”ì¸ í˜ì´ì§€] ì‚¬ìš©ì ìƒíƒœ:", user ? "ë¡œê·¸ì¸ë¨" : "ë¯¸ë¡œê·¸ì¸");
            });
        }

        // â”€â”€ ì¸ì¦ ê°€ë“œ (Auth Guard) â”€â”€
        // ë©”ì¸ í˜ì´ì§€ì˜ ì¹´ë“œ(.card)ë¥¼ í´ë¦­í–ˆì„ ë•Œ,
        // ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ í˜ì´ì§€ ì´ë™ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤.
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            card.addEventListener('click', (e) => {
                const user = firebase.auth().currentUser;

                if (!user) {
                    e.preventDefault(); // ê¸°ë³¸ ë™ì‘(í˜ì´ì§€ ì´ë™) ì°¨ë‹¨
                    showToast("ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. Google ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                }
            });
        });
    });

})();
